<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />
    <meta name="description" content="" />
    <meta name="author" content="" />

    <title>NHAFLOWER - Quản lý Sản phẩm</title>

    <!-- Custom fonts for this template -->
    <link
      href="../assets/vendor/fontawesome-free/css/all.min.css"
      rel="stylesheet"
      type="text/css"
    />
    <link
      href="https://fonts.googleapis.com/css?family=Nunito:200,200i,300,300i,400,400i,600,600i,700,700i,800,800i,900,900i"
      rel="stylesheet"
    />

    <!-- Custom styles for this template -->
    <link href="../assets/css/admin/sb-admin-2.min.css" rel="stylesheet" />

    <!-- Custom styles for this page -->
    <link
      href="../assets/vendor/datatables/dataTables.bootstrap4.min.css"
      rel="stylesheet"
    />
    <!-- SweetAlert2 -->
    <link
      href="https://cdn.jsdelivr.net/npm/sweetalert2@11.7.32/dist/sweetalert2.min.css"
      rel="stylesheet"
    />
    <!-- Custom admin styles -->
    <link href="../assets/css/admin/custom-admin.css" rel="stylesheet" />

    <style>
      /* Custom color scheme for NHAFLOWER */
      :root {
        --primary-color: #e91e63;
        --primary-light: #f48fb1;
        --primary-dark: #ad1457;
        --success-color: #4caf50;
        --success-light: #81c784;
        --success-dark: #2e7d32;
      }

      /* Sidebar colors */
      .bg-gradient-primary {
        background: linear-gradient(
          135deg,
          var(--primary-color),
          var(--primary-light)
        ) !important;
      }

      .sidebar .nav-item.active .nav-link {
        background-color: rgba(255, 255, 255, 0.2);
        border-radius: 0.35rem;
      }

      /* Button colors */
      .btn-gradient {
        background: linear-gradient(
          45deg,
          var(--primary-color),
          var(--primary-light)
        );
        border: none;
        color: white;
      }

      .btn-gradient:hover {
        background: linear-gradient(
          45deg,
          var(--primary-dark),
          var(--primary-color)
        );
        color: white;
      }

      /* Modal header */
      .modal-header {
        background: linear-gradient(
          135deg,
          var(--primary-color),
          var(--primary-light)
        );
        color: white;
      }

      /* Text colors */
      .text-primary {
        color: var(--primary-color) !important;
      }

      /* Card headers */
      .card-header {
        background-color: #f8f9fc;
        border-bottom: 1px solid #e3e6f0;
      }

      /* Table styling */
      .table thead th {
        background-color: var(--primary-color);
        color: white;
        border-color: var(--primary-dark);
      }

      .btn-edit {
        background-color: #17a2b8;
        border-color: #17a2b8;
        color: white;
      }

      .btn-edit:hover {
        background-color: #138496;
        border-color: #117a8b;
        color: white;
      }

      .btn-delete {
        background-color: #dc3545;
        border-color: #dc3545;
        color: white;
      }

      .btn-delete:hover {
        background-color: #c82333;
        border-color: #bd2130;
        color: white;
      }

      /* Loading state */
      .loading {
        text-align: center;
        color: #6c757d;
        font-style: italic;
      }

      /* Product image preview */
      .product-image-preview {
        width: 60px;
        height: 60px;
        object-fit: cover;
        border-radius: 8px;
        border: 2px solid #e3e6f0;
      }

      .image-upload-area {
        border: 2px dashed #e3e6f0;
        border-radius: 8px;
        padding: 20px;
        text-align: center;
        transition: all 0.3s ease;
        cursor: pointer;
      }

      .image-upload-area:hover {
        border-color: var(--primary-color);
        background-color: #f8f9fc;
      }

      .image-upload-area.dragover {
        border-color: var(--primary-color);
        background-color: #f8f9fc;
      }

      /* Status badges */
      .status-active {
        background-color: var(--success-color);
        color: white;
        padding: 4px 8px;
        border-radius: 4px;
        font-size: 0.75rem;
      }

      .status-inactive {
        background-color: #6c757d;
        color: white;
        padding: 4px 8px;
        border-radius: 4px;
        font-size: 0.75rem;
      }

      .status-out-of-stock {
        background-color: #dc3545;
        color: white;
        padding: 4px 8px;
        border-radius: 4px;
        font-size: 0.75rem;
      }

      /* Form validation */
      .is-invalid {
        border-color: #dc3545;
      }

      .invalid-feedback {
        display: block;
        color: #dc3545;
        font-size: 0.875rem;
        margin-top: 0.25rem;
      }

      /* Custom SweetAlert2 colors */
      .swal2-confirm {
        background-color: var(--primary-color) !important;
      }

      .swal2-confirm:hover {
        background-color: var(--primary-dark) !important;
      }
    </style>
  </head>

  <body id="page-top">
    <!-- Page Wrapper -->
    <div id="wrapper">
      <!-- Sidebar -->
      <ul
        class="navbar-nav bg-gradient-primary sidebar sidebar-dark accordion"
        id="accordionSidebar"
      >
        <!-- Sidebar - Brand -->
        <a
          class="sidebar-brand d-flex align-items-center justify-content-center"
          href="index.html"
        >
          <div class="sidebar-brand-icon rotate-n-15">
            <i class="fas fa-seedling"></i>
          </div>
          <div class="sidebar-brand-text mx-3">NHAFLOWER</div>
        </a>

        <!-- Divider -->
        <hr class="sidebar-divider my-0" />

        <!-- Nav Item - Dashboard -->
        <li class="nav-item">
          <a class="nav-link" href="index.html">
            <i class="fas fa-fw fa-tachometer-alt"></i>
            <span>Dashboard</span>
          </a>
        </li>

        <!-- Divider -->
        <hr class="sidebar-divider" />

        <!-- Heading -->
        <div class="sidebar-heading">Quản lý chính</div>

        <!-- Nav Item - Khách hàng -->
        <li class="nav-item">
          <a class="nav-link" href="customers.html">
            <i class="fas fa-fw fa-users"></i>
            <span>Khách hàng</span>
          </a>
        </li>

        <!-- Nav Item - Sản phẩm -->
        <li class="nav-item active">
          <a class="nav-link" href="products.html">
            <i class="fas fa-fw fa-leaf"></i>
            <span>Sản phẩm</span>
          </a>
        </li>

        <!-- Nav Item - Đơn hàng -->
        <li class="nav-item">
          <a class="nav-link" href="orders.html">
            <i class="fas fa-fw fa-shopping-cart"></i>
            <span>Đơn hàng</span>
          </a>
        </li>

        <!-- Nav Item - Danh mục -->
        <li class="nav-item">
          <a class="nav-link" href="categories.html">
            <i class="fas fa-fw fa-tags"></i>
            <span>Danh mục</span>
          </a>
        </li>

        <!-- Divider -->
        <hr class="sidebar-divider" />

        <!-- Heading -->
        <div class="sidebar-heading">Báo cáo & Thống kê</div>

        <!-- Nav Item - Charts -->
        <li class="nav-item">
          <a class="nav-link" href="charts.html">
            <i class="fas fa-fw fa-chart-area"></i>
            <span>Biểu đồ</span></a
          >
        </li>

        <!-- Nav Item - Reports -->
        <li class="nav-item">
          <a class="nav-link" href="reports.html">
            <i class="fas fa-fw fa-file-alt"></i>
            <span>Báo cáo</span></a
          >
        </li>

        <!-- Divider -->
        <hr class="sidebar-divider" />

        <!-- Heading -->
        <div class="sidebar-heading">Hệ thống</div>

        <!-- Nav Item - Settings Collapse Menu -->
        <li class="nav-item">
          <a
            class="nav-link collapsed"
            href="#"
            data-toggle="collapse"
            data-target="#collapseSettings"
            aria-expanded="true"
            aria-controls="collapseSettings"
          >
            <i class="fas fa-fw fa-cog"></i>
            <span>Cài đặt</span>
          </a>
          <div
            id="collapseSettings"
            class="collapse"
            aria-labelledby="headingSettings"
            data-parent="#accordionSidebar"
          >
            <div class="bg-white py-2 collapse-inner rounded">
              <h6 class="collapse-header">Cài đặt hệ thống:</h6>              <a class="collapse-item" href="settings-general.html">Chung</a>
              <a class="collapse-item" href="settings-payment.html"
                >Thanh toán</a
              >
              <a class="collapse-item" href="settings-shipping.html"
                >Vận chuyển</a
              >
            </div>
          </div>
        </li>

        <!-- Divider -->
        <hr class="sidebar-divider d-none d-md-block" />

        <!-- Sidebar Toggler (Sidebar) -->
        <div class="text-center d-none d-md-inline">
          <button class="rounded-circle border-0" id="sidebarToggle"></button>
        </div>

        <!-- Sidebar Message -->
        <div class="sidebar-card d-none d-lg-flex">
          <img
            class="sidebar-card-illustration mb-2"
            src="../assets/img/admin/undraw_rocket.svg"
            alt="..."
          />
          <p class="text-center mb-2">
            <strong>NHAFLOWER</strong> Hệ thống quản lý bán hoa chuyên nghiệp!
          </p>
          <a class="btn btn-success btn-sm" href="../user/home.html"
            >Xem trang chủ</a
          >
        </div>
      </ul>
      <!-- End of Sidebar -->

      <!-- Content Wrapper -->
      <div id="content-wrapper" class="d-flex flex-column">
        <!-- Main Content -->
        <div id="content">
          <!-- Topbar -->
          <nav
            class="navbar navbar-expand navbar-light bg-white topbar mb-4 static-top shadow"
          >
            <!-- Sidebar Toggle (Topbar) -->
            <button
              id="sidebarToggleTop"
              class="btn btn-link d-md-none rounded-circle mr-3"
            >
              <i class="fa fa-bars"></i>
            </button>

            <!-- Topbar Search -->
            <form
              class="d-none d-sm-inline-block form-inline mr-auto ml-md-3 my-2 my-md-0 mw-100 navbar-search"
            >
              <div class="input-group">
                <input
                  type="text"
                  class="form-control bg-light border-0 small"
                  placeholder="Tìm kiếm sản phẩm..."
                  aria-label="Search"
                  aria-describedby="basic-addon2"
                />
                <div class="input-group-append">
                  <button
                    class="btn btn-primary"
                    type="button"
                    style="
                      background-color: var(--primary-color);
                      border-color: var(--primary-color);
                    "
                  >
                    <i class="fas fa-search fa-sm"></i>
                  </button>
                </div>
              </div>
            </form>

            <!-- Topbar Navbar -->
            <ul class="navbar-nav ml-auto">              <!-- Nav Item - Alerts -->
              <li class="nav-item dropdown no-arrow mx-1">
                <a
                  class="nav-link dropdown-toggle"
                  href="#"
                  id="alertsDropdown"
                  role="button"
                  data-toggle="dropdown"
                  aria-haspopup="true"
                  aria-expanded="false"
                >
                  <i class="fas fa-bell fa-fw"></i>
                  <!-- Counter - Alerts -->
                  <span class="badge badge-danger badge-counter">3+</span>
                </a>
                <!-- Dropdown - Alerts -->
                <div class="dropdown-list dropdown-menu dropdown-menu-right shadow animated--grow-in" aria-labelledby="alertsDropdown">
                  <h6 class="dropdown-header">Trung tâm Thông báo</h6>
                  <a class="dropdown-item d-flex align-items-center" href="notifications.html">
                    <div class="mr-3">
                      <div class="icon-circle bg-primary">
                        <i class="fas fa-file-alt text-white"></i>
                      </div>
                    </div>
                    <div>
                      <div class="small text-gray-500">12 tháng 2024</div>
                      <span class="font-weight-bold">Báo cáo sản phẩm tháng mới đã được tạo!</span>
                    </div>
                  </a>
                  <a class="dropdown-item d-flex align-items-center" href="notifications.html">
                    <div class="mr-3">
                      <div class="icon-circle bg-success">
                        <i class="fas fa-box text-white"></i>
                      </div>
                    </div>
                    <div>
                      <div class="small text-gray-500">12 tháng 2024</div>
                      Sản phẩm "Hoa hồng đỏ" đã được cập nhật thành công!
                    </div>
                  </a>
                  <a class="dropdown-item d-flex align-items-center" href="notifications.html">
                    <div class="mr-3">
                      <div class="icon-circle bg-warning">
                        <i class="fas fa-exclamation-triangle text-white"></i>
                      </div>
                    </div>
                    <div>
                      <div class="small text-gray-500">11 tháng 2024</div>
                      <span class="font-weight-bold">Cảnh báo: 5 sản phẩm sắp hết hàng!</span>
                    </div>
                  </a>
                  <a class="dropdown-item text-center small text-gray-500" href="notifications.html">
                    <i class="fas fa-eye"></i> Xem tất cả thông báo
                  </a>
                </div>
              </li>

              <div class="topbar-divider d-none d-sm-block"></div>

              <!-- Nav Item - User Information -->
              <li class="nav-item dropdown no-arrow">
                <a
                  class="nav-link dropdown-toggle"
                  href="#"
                  id="userDropdown"
                  role="button"
                  data-toggle="dropdown"
                  aria-haspopup="true"
                  aria-expanded="false"
                >
                  <span class="mr-2 d-none d-lg-inline text-gray-600 small"
                    >Admin NHAFLOWER</span
                  >
                  <img
                    class="img-profile rounded-circle"
                    src="../assets/img/admin/undraw_profile.svg"
                  />
                </a>
                <!-- Dropdown - User Information -->
                <div
                  class="dropdown-menu dropdown-menu-right shadow animated--grow-in"
                  aria-labelledby="userDropdown"
                >
                  <a class="dropdown-item" href="#">
                    <i class="fas fa-user fa-sm fa-fw mr-2 text-gray-400"></i>
                    Hồ sơ
                  </a>
                  <a class="dropdown-item" href="#">
                    <i class="fas fa-cogs fa-sm fa-fw mr-2 text-gray-400"></i>
                    Cài đặt
                  </a>
                  <div class="dropdown-divider"></div>
                  <a
                    class="dropdown-item"
                    href="#"
                    data-toggle="modal"
                    data-target="#logoutModal"
                  >
                    <i
                      class="fas fa-sign-out-alt fa-sm fa-fw mr-2 text-gray-400"
                    ></i>
                    Đăng xuất
                  </a>
                </div>
              </li>
            </ul>
          </nav>
          <!-- End of Topbar -->

          <!-- Begin Page Content -->
          <div class="container-fluid">
            <!-- Page Heading -->
            <div
              class="d-sm-flex align-items-center justify-content-between mb-4"
            >
              <h1 class="h3 mb-0 text-gray-800">
                <i class="fas fa-leaf mr-2 text-primary"></i>Quản lý Sản phẩm
              </h1>
              <button
                class="btn btn-gradient btn-sm shadow-sm"
                data-toggle="modal"
                data-target="#addProductModal"
              >
                <i class="fas fa-plus fa-sm mr-1"></i>Thêm sản phẩm
              </button>
            </div>

            <!-- DataTales Example -->
            <div class="card shadow mb-4">
              <div class="card-header py-3">
                <h6 class="m-0 font-weight-bold text-primary">
                  <i class="fas fa-table mr-1"></i>Danh sách sản phẩm
                </h6>
              </div>
              <div class="card-body">
                <div class="table-responsive">
                  <table
                    class="table table-bordered"
                    id="productsTable"
                    width="100%"
                    cellspacing="0"
                  >
                    <thead>
                      <tr>
                        <th>ID</th>
                        <th>Hình ảnh</th>
                        <th>Tên sản phẩm</th>
                        <th>Danh mục</th>
                        <th>Giá</th>
                        <th>Số lượng</th>
                        <th>Trạng thái</th>
                        <th>Thao tác</th>
                      </tr>
                    </thead>
                    <tbody id="productsTableBody">
                      <!-- DataTables will populate this -->
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>
          <!-- /.container-fluid -->
        </div>
        <!-- End of Main Content -->

        <!-- Footer -->
        <footer class="sticky-footer bg-white">
          <div class="container my-auto">
            <div class="copyright text-center my-auto">
              <span>Copyright &copy; NHAFLOWER 2025</span>
            </div>
          </div>
        </footer>
        <!-- End of Footer -->
      </div>
      <!-- End of Content Wrapper -->
    </div>
    <!-- End of Page Wrapper -->

    <!-- Add Product Modal -->
    <div class="modal fade" id="addProductModal" tabindex="-1" role="dialog">
      <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">
              <i class="fas fa-plus mr-2"></i>Thêm sản phẩm mới
            </h5>
            <button type="button" class="close text-white" data-dismiss="modal">
              <span>&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <form id="addProductForm">
              <div class="row">
                <div class="col-md-6">
                  <div class="form-group">
                    <label>Tên sản phẩm *</label>
                    <input
                      type="text"
                      class="form-control"
                      name="ten_hoa"
                      placeholder="Nhập tên sản phẩm"
                      required
                    />
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="form-group">
                    <label>Danh mục *</label>
                    <select class="form-control" name="id_loaihoa" required>
                      <option value="">Chọn danh mục</option>
                      <!-- Categories will be loaded dynamically -->
                    </select>
                  </div>
                </div>
              </div>

              <div class="row">
                <div class="col-md-6">
                  <div class="form-group">
                    <label>Giá sản phẩm (VNĐ) *</label>
                    <input
                      type="number"
                      class="form-control"
                      name="gia"
                      placeholder="Nhập giá sản phẩm"
                      min="0"
                      step="1000"
                      required
                    />
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="form-group">
                    <label>Số lượng tồn kho *</label>
                    <input
                      type="number"
                      class="form-control"
                      name="so_luong"
                      placeholder="Nhập số lượng"
                      min="0"
                      required
                    />
                  </div>
                </div>
              </div>

              <div class="form-group">
                <label>Mô tả sản phẩm</label>
                <textarea
                  class="form-control"
                  name="mo_ta"
                  rows="4"
                  placeholder="Nhập mô tả chi tiết về sản phẩm"
                ></textarea>
              </div>

              <div class="form-group">
                <label>Hình ảnh sản phẩm *</label>
                <div class="image-upload-area" id="imageUploadArea">
                  <i class="fas fa-cloud-upload-alt fa-3x text-muted mb-3"></i>
                  <p class="text-muted">
                    Kéo thả hình ảnh vào đây hoặc <strong>click để chọn</strong>
                  </p>
                  <input
                    type="file"
                    class="d-none"
                    id="productImageInput"
                    name="hinh_anh"
                    accept="image/*"
                    required
                  />
                </div>
                <div id="imagePreview" class="mt-3 d-none">
                  <img
                    id="previewImg"
                    class="img-thumbnail"
                    style="max-width: 200px"
                  />
                  <button
                    type="button"
                    class="btn btn-sm btn-danger ml-2"
                    id="removeImageBtn"
                  >
                    <i class="fas fa-times"></i> Xóa
                  </button>
                </div>
              </div>

              <div class="form-group">
                <label>Trạng thái</label>
                <select class="form-control" name="trang_thai">
                  <option value="active">Hoạt động</option>
                  <option value="inactive">Không hoạt động</option>
                </select>
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-dismiss="modal"
            >
              Hủy
            </button>
            <button type="button" class="btn btn-gradient" id="addProductBtn">
              <i class="fas fa-save mr-1"></i>Lưu
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Edit Product Modal -->
    <div class="modal fade" id="editProductModal" tabindex="-1" role="dialog">
      <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">
              <i class="fas fa-edit mr-2"></i>Chỉnh sửa sản phẩm
            </h5>
            <button type="button" class="close text-white" data-dismiss="modal">
              <span>&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <form id="editProductForm">
              <input type="hidden" name="product_id" id="editProductId" />
              <div class="row">
                <div class="col-md-6">
                  <div class="form-group">
                    <label>Tên sản phẩm *</label>
                    <input
                      type="text"
                      class="form-control"
                      name="ten_hoa"
                      id="editProductName"
                      required
                    />
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="form-group">
                    <label>Danh mục *</label>
                    <select
                      class="form-control"
                      name="id_loaihoa"
                      id="editProductCategory"
                      required
                    >
                      <option value="">Chọn danh mục</option>
                      <!-- Categories will be loaded dynamically -->
                    </select>
                  </div>
                </div>
              </div>

              <div class="row">
                <div class="col-md-6">
                  <div class="form-group">
                    <label>Giá sản phẩm (VNĐ) *</label>
                    <input
                      type="number"
                      class="form-control"
                      name="gia"
                      id="editProductPrice"
                      min="0"
                      step="1000"
                      required
                    />
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="form-group">
                    <label>Số lượng tồn kho *</label>
                    <input
                      type="number"
                      class="form-control"
                      name="so_luong"
                      id="editProductStock"
                      min="0"
                      required
                    />
                  </div>
                </div>
              </div>

              <div class="form-group">
                <label>Mô tả sản phẩm</label>
                <textarea
                  class="form-control"
                  name="mo_ta"
                  id="editProductDescription"
                  rows="4"
                ></textarea>
              </div>

              <div class="form-group">
                <label>Hình ảnh sản phẩm</label>
                <div class="image-upload-area" id="editImageUploadArea">
                  <i class="fas fa-cloud-upload-alt fa-3x text-muted mb-3"></i>
                  <p class="text-muted">
                    Kéo thả hình ảnh mới vào đây hoặc
                    <strong>click để chọn</strong>
                  </p>
                  <input
                    type="file"
                    class="d-none"
                    id="editProductImageInput"
                    name="hinh_anh"
                    accept="image/*"
                  />
                </div>
                <div id="editImagePreview" class="mt-3">
                  <!-- Current image will be shown here -->
                </div>
              </div>

              <div class="form-group">
                <label>Trạng thái</label>
                <select
                  class="form-control"
                  name="trang_thai"
                  id="editProductStatus"
                >
                  <option value="active">Hoạt động</option>
                  <option value="inactive">Không hoạt động</option>
                </select>
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-dismiss="modal"
            >
              Hủy
            </button>
            <button
              type="button"
              class="btn btn-gradient"
              id="updateProductBtn"
            >
              <i class="fas fa-save mr-1"></i>Cập nhật
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Logout Modal-->
    <div
      class="modal fade"
      id="logoutModal"
      tabindex="-1"
      role="dialog"
      aria-labelledby="exampleModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div
            class="modal-header"
            style="
              background: linear-gradient(
                135deg,
                var(--primary-color),
                var(--primary-light)
              );
            "
          >
            <h5 class="modal-title" id="exampleModalLabel" style="color: white">
              Xác nhận đăng xuất
            </h5>
            <button
              class="close text-white"
              type="button"
              data-dismiss="modal"
              aria-label="Close"
            >
              <span aria-hidden="true">×</span>
            </button>
          </div>
          <div class="modal-body">
            Bạn có chắc chắn muốn đăng xuất khỏi phiên làm việc hiện tại không?
          </div>
          <div class="modal-footer">
            <button
              class="btn btn-secondary"
              type="button"
              data-dismiss="modal"
            >
              Hủy
            </button>
            <a class="btn btn-gradient" href="../auth/logout.php">Đăng xuất</a>
          </div>
        </div>
      </div>
    </div>

    <!-- Bootstrap core JavaScript-->
    <script src="../assets/vendor/jquery/jquery.min.js"></script>
    <script src="../assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

    <!-- Core plugin JavaScript-->
    <script src="../assets/vendor/jquery-easing/jquery.easing.min.js"></script>

    <!-- Custom scripts for all pages-->
    <script src="../assets/js/admin/sb-admin-2.min.js"></script>

    <!-- Page level plugins -->
    <script src="../assets/vendor/datatables/jquery.dataTables.min.js"></script>
    <script src="../assets/vendor/datatables/dataTables.bootstrap4.min.js"></script>

    <!-- SweetAlert2 -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.7.32/dist/sweetalert2.all.min.js"></script>

    <!-- Custom JavaScript for Products Management -->
    <script src="../assets/js/admin/products.js"></script>

    <script>
      // Image upload functionality
      $(document).ready(function () {
        // Add Product Image Upload
        $("#imageUploadArea").click(function () {
          $("#productImageInput").click();
        });

        $("#productImageInput").change(function () {
          handleImagePreview(this, "#imagePreview", "#previewImg");
        });

        // Edit Product Image Upload
        $("#editImageUploadArea").click(function () {
          $("#editProductImageInput").click();
        });

        $("#editProductImageInput").change(function () {
          handleImagePreview(this, "#editImagePreview", "#editPreviewImg");
        });

        // Remove image function
        $(document).on("click", "#removeImageBtn", function () {
          $("#imagePreview").addClass("d-none");
          $("#productImageInput").val("");
          $("#imageUploadArea").removeClass("border-danger");
        });

        // Drag and drop functionality
        $(".image-upload-area").on("dragover", function (e) {
          e.preventDefault();
          $(this).addClass("dragover");
        });

        $(".image-upload-area").on("dragleave", function (e) {
          e.preventDefault();
          $(this).removeClass("dragover");
        });

        $(".image-upload-area").on("drop", function (e) {
          e.preventDefault();
          $(this).removeClass("dragover");

          var files = e.originalEvent.dataTransfer.files;
          if (files.length > 0) {
            var input = $(this).find('input[type="file"]')[0];
            input.files = files;
            $(input).trigger("change");
          }
        });
      });

      function handleImagePreview(input, previewContainer, previewImg) {
        if (input.files && input.files[0]) {
          var reader = new FileReader();

          reader.onload = function (e) {
            $(previewContainer).removeClass("d-none");
            if (!$(previewImg).length) {
              $(previewContainer).append(
                `<img id="${previewImg.substring(
                  1
                )}" class="img-thumbnail" style="max-width: 200px;">`
              );
              $(previewContainer).append(
                `<button type="button" class="btn btn-sm btn-danger ml-2" onclick="removeNewImage('${previewContainer}', '${input.id}')"><i class="fas fa-times"></i> Xóa</button>`
              );
            }
            $(previewImg).attr("src", e.target.result);
          };

          reader.readAsDataURL(input.files[0]);
        }
      }

      function removeNewImage(previewContainer, inputId) {
        $(previewContainer + " img").remove();
        $(previewContainer + " button").remove();
        $("#" + inputId).val("");
      }

      // Load products data
      function loadProducts() {
        $.ajax({
          url: "../api/san_pham.php?action=get_all",
          type: "GET",
          dataType: "json",
          success: function (response) {
            if (response.success) {
              productsTable.clear();

              if (response.data && response.data.length > 0) {
                $.each(response.data, function (index, product) {
                  var statusBadge = getStatusBadge(
                    product.status,
                    product.so_luong                  );
                  var imageHtml = product.hinh_anh
                    ? `<img src="../assets/img/products/${product.hinh_anh}" class="product-image-preview" alt="${product.ten_hoa}">`
                    : `<div class="product-image-preview d-flex align-items-center justify-content-center bg-light"><i class="fas fa-image text-muted"></i></div>`;

                  var priceFormatted = new Intl.NumberFormat("vi-VN", {
                    style: "currency",
                    currency: "VND",
                  }).format(product.gia);

                  productsTable.row.add([
                    product.id_sanpham,
                    imageHtml,
                    product.ten_hoa,
                    product.ten_loai || "Chưa phân loại",
                    priceFormatted,
                    product.so_luong,
                    statusBadge,
                    `<div class="btn-group" role="group">
                                      <button class="btn btn-edit btn-sm" onclick="editProduct(${product.id_sanpham})" title="Chỉnh sửa">
                                          <i class="fas fa-edit"></i>
                                      </button>
                                      <button class="btn btn-delete btn-sm" onclick="deleteProduct(${product.id_sanpham}, '${product.ten_hoa}')" title="Xóa">
                                          <i class="fas fa-trash"></i>
                                      </button>
                                  </div>`,
                  ]);
                });
              }

              productsTable.draw();
            } else {
              showAlert(
                "error",
                "Lỗi tải dữ liệu: " + (response.message || "Có lỗi xảy ra")
              );
            }
          },
          error: function (xhr, status, error) {
            console.error("Error loading products:", error);
            showAlert(
              "error",
              "Không thể tải danh sách sản phẩm. Vui lòng thử lại."
            );
          },
        });
      }

      // Validate product form
      function validateProductForm(formSelector) {
        var isValid = true;
        var form = $(formSelector);

        // Clear previous errors
        form.find(".is-invalid").removeClass("is-invalid");
        form.find(".invalid-feedback").remove();

        // Validate required fields
        form.find("[required]").each(function () {
          var field = $(this);
          var value = field.val().trim();

          if (!value) {
            field.addClass("is-invalid");
            field.after(
              '<div class="invalid-feedback">Trường này không được để trống</div>'
            );
            isValid = false;
          }
        });

        // Validate price
        var price = form.find('input[name="gia"]').val();
        if (price && parseInt(price) < 0) {
          form.find('input[name="gia"]').addClass("is-invalid");
          form
            .find('input[name="gia"]')
            .after(
              '<div class="invalid-feedback">Giá phải lớn hơn hoặc bằng 0</div>'
            );
          isValid = false;
        }

        // Validate stock - sửa field name
        var stock = form.find('input[name="so_luong"]').val();
        if (stock && parseInt(stock) < 0) {
          form.find('input[name="so_luong"]').addClass("is-invalid");
          form
            .find('input[name="so_luong"]')
            .after(
              '<div class="invalid-feedback">Số lượng phải lớn hơn hoặc bằng 0</div>'
            );
          isValid = false;
        }

        return isValid;
      }

      // Add new product
      function addProduct() {
        if (!validateProductForm("#addProductForm")) {
          return;
        }

        var formData = new FormData();

        // Get form data - sử dụng đúng tên fields
        formData.append("ten_hoa", $('input[name="ten_hoa"]').val());
        formData.append("id_loaihoa", $('select[name="id_loaihoa"]').val());
        formData.append("gia", $('input[name="gia"]').val());
        formData.append("so_luong", $('input[name="so_luong"]').val());
        formData.append("mo_ta", $('textarea[name="mo_ta"]').val());

        // Add image file
        var imageFile = $("#productImageInput")[0].files[0];
        if (imageFile) {
          formData.append("hinh_anh", imageFile);
        }

        // Rest of the function stays the same...
      }
    </script>
  </body>
</html>
